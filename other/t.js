const http = require('http')
const { execSync } = require('child_process')

function replaceCharacters(mapping, str) {
    return str
        .split("")
        .map(char => mapping[char] || char)
        .join("")
}

const mapping = {
    // _g1
    // "Ⴠ": "A",
    // "Ⴡ": "B",
    // "Ⴢ": "C",
    // "Ⴣ": "D",
    // "Ⴤ": "E",
    // "Ⴥ": "F",
    // "჆": "G",
    // "Ⴧ": "H",
    // "჈": "I",
    // "჉": "J",
    // "჊": "K",
    // "჋": "L",
    // "჌": "M",
    // "Ⴭ": "N",
    // "჎": "O",
    // "჏": "P",
    // "ა": "Q",
    // "ბ": "R",
    // "გ": "S",
    // "დ": "T",
    // "ე": "U",
    // "ვ": "V",
    // "ზ": "W",
    // "თ": "X",
    // "ი": "Y",
    // "კ": "Z",
    // "რ": "a",
    // "ს": "b",
    // "ტ": "c",
    // "უ": "d",
    // "ფ": "e",
    // "ქ": "f",
    // "ღ": "g",
    // "ყ": "h",
    // "შ": "i",
    // "ჩ": "j",
    // "ც": "k",
    // "ძ": "l",
    // "წ": "m",
    // "ჭ": "n",
    // "ხ": "o",
    // "ჯ": "p",
    // "ჰ": "q",
    // "ჱ": "r",
    // "ჲ": "s",
    // "ჳ": "t",
    // "ჴ": "u",
    // "ჵ": "v",
    // "ჶ": "w",
    // "ჷ": "x",
    // "ჸ": "y",
    // "ჹ": "z",
    // "Ⴍ": ".",
    // "Ⴋ": ",",
    // "Ⴌ": "-",
    // "Ⴀ": "!",
    // "Ⴞ": "?",
    // "Ⴙ": ":",
    // "Ⴚ": ";",
    // "Ⴁ": "\"",
    // "Ⴆ": "'",
    // "ჟ": "`",
    // "ჽ": "~",
    // "Ⴇ": "(",
    // "Ⴈ": ")",
    // "ლ": "[",
    // "ნ": "]",
    // "Ⴉ": "*",
    // "Ⴏ": "0",
    // "Ⴐ": "1",
    // "Ⴑ": "2",
    // "Ⴒ": "3",
    // "Ⴓ": "4",
    // "Ⴔ": "5",
    // "Ⴕ": "6",
    // "Ⴖ": "7",
    // "Ⴗ": "8",
    // "Ⴘ": "9",

    // _k1
    // "ダ": "A",
    // "チ": "B",
    // "ヂ": "C",
    // "ッ": "D",
    // "ツ": "E",
    // "ヅ": "F",
    // "テ": "G",
    // "デ": "H",
    // "ト": "I",
    // "ド": "J",
    // "ナ": "K",
    // "ニ": "L",
    // "ヌ": "M",
    // "ネ": "N",
    // "ノ": "O",
    // "ハ": "P",
    // "バ": "Q",
    // "パ": "R",
    // "ヒ": "S",
    // "ビ": "T",
    // "ピ": "U",
    // "フ": "V",
    // "ブ": "W",
    // "プ": "X",
    // "ヘ": "Y",
    // "ベ": "Z",
    // "ム": "a",
    // "メ": "b",
    // "モ": "c",
    // "ャ": "d",
    // "ヤ": "e",
    // "ュ": "f",
    // "ユ": "g",
    // "ョ": "h",
    // "ヨ": "i",
    // "ラ": "j",
    // "リ": "k",
    // "ル": "l",
    // "レ": "m",
    // "ロ": "n",
    // "ヮ": "o",
    // "ワ": "p",
    // "ヰ": "q",
    // "ヱ": "r",
    // "ヲ": "s",
    // "ン": "t",
    // "ヴ": "u",
    // "ヵ": "v",
    // "ヶ": "w",
    // "ヷ": "x",
    // "ヸ": "y",
    // "ヹ": "z",
    // "キ": ".",
    // "カ": ",",
    // "ガ": "-",
    // "゠": "!",
    // "ゾ": "?",
    // "ス": ":",
    // "ズ": ";",
    // "ァ": "\"",
    // "ウ": "'",
    // "ミ": "`",
    // "ヽ": "~",
    // "ェ": "(",
    // "エ": ")",
    // "ペ": "[",
    // "ボ": "]",
    // "ォ": "*",
    // "ク": "0",
    // "グ": "1",
    // "ケ": "2",
    // "ゲ": "3",
    // "コ": "4",
    // "ゴ": "5",
    // "サ": "6",
    // "ザ": "7",
    // "シ": "8",
    // "ジ": "9",

    // _s1
    // "ᮠ": "A",
    // "ᮡ": "B",
    // "ᮢ": "C",
    // "ᮣ": "D",
    // "ᮤ": "E",
    // "ᮥ": "F",
    // "ᮦ": "G",
    // "ᮧ": "H",
    // "ᮨ": "I",
    // "ᮩ": "J",
    // "᮪": "K",
    // "᮫": "L",
    // "ᮬ": "M",
    // "ᮭ": "N",
    // "ᮮ": "O",
    // "ᮯ": "P",
    // "᮰": "Q",
    // "᮱": "R",
    // "᮲": "S",
    // "᮳": "T",
    // "᮴": "U",
    // "᮵": "V",
    // "᮶": "W",
    // "᮷": "X",
    // "᮸": "Y",
    // "᮹": "Z",
    // "ᯀ": "a",
    // "ᯁ": "b",
    // "ᯂ": "c",
    // "ᯃ": "d",
    // "ᯄ": "e",
    // "ᯅ": "f",
    // "ᯆ": "g",
    // "ᯇ": "h",
    // "ᯈ": "i",
    // "ᯉ": "j",
    // "ᯊ": "k",
    // "ᯋ": "l",
    // "ᯌ": "m",
    // "ᯍ": "n",
    // "ᯎ": "o",
    // "ᯏ": "p",
    // "ᯐ": "q",
    // "ᯑ": "r",
    // "ᯒ": "s",
    // "ᯓ": "t",
    // "ᯔ": "u",
    // "ᯕ": "v",
    // "ᯖ": "w",
    // "ᯗ": "x",
    // "ᯘ": "y",
    // "ᯙ": "z",
    // "ᮍ": ".",
    // "ᮋ": ",",
    // "ᮌ": "-",
    // "ᮀ": "!",
    // "ᮞ": "?",
    // "ᮙ": ":",
    // "ᮚ": ";",
    // "ᮁ": "\"",
    // "ᮆ": "'",
    // "ᮿ": "`",
    // "ᯝ": "~",
    // "ᮇ": "(",
    // "ᮈ": ")",
    // "ᮺ": "[",
    // "ᮼ": "]",
    // "ᮉ": "*",
    // "ᮏ": "0",
    // "ᮐ": "1",
    // "ᮑ": "2",
    // "ᮒ": "3",
    // "ᮓ": "4",
    // "ᮔ": "5",
    // "ᮕ": "6",
    // "ᮖ": "7",
    // "ᮗ": "8",
    // "ᮘ": "9",

    //fs_s1
    "ᯏ": "A",
    "ᯐ": "B",
    "ᯑ": "C",
    "ᯒ": "D",
    "ᯓ": "E",
    "ᯔ": "F",
    "ᯕ": "G",
    "ᯖ": "H",
    "ᯗ": "I",
    "ᯘ": "J",
    "ᯙ": "K",
    "ᯚ": "L",
    "ᯛ": "M",
    "ᯜ": "N",
    "ᯝ": "O",
    "ᮀ": "P",
    "ᮁ": "Q",
    "ᮂ": "R",
    "ᮃ": "S",
    "ᮄ": "T",
    "ᮅ": "U",
    "ᮆ": "V",
    "ᮇ": "W",
    "ᮈ": "X",
    "ᮉ": "Y",
    "ᮊ": "Z",
    "ᮑ": "a",
    "ᮒ": "b",
    "ᮓ": "c",
    "ᮔ": "d",
    "ᮕ": "e",
    "ᮖ": "f",
    "ᮗ": "g",
    "ᮘ": "h",
    "ᮙ": "i",
    "ᮚ": "j",
    "ᮛ": "k",
    "ᮜ": "l",
    "ᮝ": "m",
    "ᮞ": "n",
    "ᮟ": "o",
    "ᮠ": "p",
    "ᮡ": "q",
    "ᮢ": "r",
    "ᮣ": "s",
    "ᮤ": "t",
    "ᮥ": "u",
    "ᮦ": "v",
    "ᮧ": "w",
    "ᮨ": "x",
    "ᮩ": "y",
    "᮪": "z",
    "ᮼ": ".",
    "ᮺ": ",",
    "ᮻ": "-",
    "ᮯ": "!",
    "ᯍ": "?",
    "ᯈ": ":",
    "ᯉ": ";",
    "᮰": "\"",
    "᮵": "'",
    "ᮐ": "`",
    "ᮮ": "~",
    "᮶": "(",
    "᮷": ")",
    "ᮋ": "[",
    "ᮍ": "]",
    "᮸": "*",
    "ᮾ": "0",
    "ᮿ": "1",
    "ᯀ": "2",
    "ᯁ": "3",
    "ᯂ": "4",
    "ᯃ": "5",
    "ᯄ": "6",
    "ᯅ": "7",
    "ᯆ": "8",
    "ᯇ": "9",

    // fs_k1
    "ワ": "A",
    "ヰ": "B",
    "ヱ": "C",
    "ヲ": "D",
    "ン": "E",
    "ᯔ": "F",
    "ヵ": "G",
    "ヶ": "H",
    "ヷ": "I",
    "ヸ": "J",
    "ヹ": "K",
    "ヺ": "L",
    "・": "M",
    "ー": "N",
    "ヽ": "O",
    "゠": "P",
    "ァ": "Q",
    "ア": "R",
    "ィ": "S",
    "イ": "T",
    "ゥ": "U",
    "ウ": "V",
    "ェ": "W",
    "エ": "X",
    "ォ": "Y",
    "オ": "Z",
    "ケ": "a",
    "ゲ": "b",
    "コ": "c",
    "ゴ": "d",
    "サ": "e",
    "ザ": "f",
    "シ": "g",
    "ジ": "h",
    "ス": "i",
    "ズ": "j",
    "セ": "k",
    "ゼ": "l",
    "ソ": "m",
    "ゾ": "n",
    "タ": "o",
    "ダ": "p",
    "チ": "q",
    "ヂ": "r",
    "ッ": "s",
    "ツ": "t",
    "ヅ": "u",
    "テ": "v",
    "デ": "w",
    "ト": "x",
    "ド": "y",
    "ナ": "z",
    "ボ": ".",
    "ペ": ",",
    "ホ": "-",
    "ハ": "!",
    "ロ": "?",
    "ヨ": ":",
    "ラ": ";",
    "バ": "\"",
    "フ": "'",
    "グ": "`",
    "ノ": "~",
    "ブ": "(",
    "プ": ")",
    "カ": "[",
    "キ": "]",
    "ヘ": "*",
    "マ": "0",
    "ミ": "1",
    "ム": "2",
    "メ": "3",
    "モ": "4",
    "ャ": "5",
    "ヤ": "6",
    "ュ": "7",
    "ユ": "8",
    "ョ": "9",

    // fs_g1
    "ჯ": "A",
    "ჰ": "B",
    "ჱ": "C",
    "ჲ": "D",
    "ჳ": "E",
    "ჴ": "F",
    "ჵ": "G",
    "ჶ": "H",
    "ჷ": "I",
    "ჸ": "J",
    "ჹ": "K",
    "ჺ": "L",
    "჻": "M",
    "ჼ": "N",
    "ჽ": "O",
    "Ⴀ": "P",
    "Ⴁ": "Q",
    "Ⴂ": "R",
    "Ⴃ": "S",
    "Ⴄ": "T",
    "Ⴅ": "U",
    "Ⴆ": "V",
    "Ⴇ": "W",
    "Ⴈ": "X",
    "Ⴉ": "Y",
    "Ⴊ": "Z",
    "Ⴑ": "a",
    "Ⴒ": "b",
    "Ⴓ": "c",
    "Ⴔ": "d",
    "Ⴕ": "e",
    "Ⴖ": "f",
    "Ⴗ": "g",
    "Ⴘ": "h",
    "Ⴙ": "i",
    "Ⴚ": "j",
    "Ⴛ": "k",
    "Ⴜ": "l",
    "Ⴝ": "m",
    "Ⴞ": "n",
    "Ⴟ": "o",
    "Ⴠ": "p",
    "Ⴡ": "q",
    "Ⴢ": "r",
    "Ⴣ": "s",
    "Ⴤ": "t",
    "Ⴥ": "u",
    "჆": "v",
    "Ⴧ": "w",
    "჈": "x",
    "჉": "y",
    "჊": "z",
    "ნ": ".",
    "ლ": ",",
    "მ": "-",
    "჏": "!",
    "ჭ": "?",
    "შ": ":",
    "ჩ": ";",
    "ა": "\"",
    "ვ": "'",
    "Ⴐ": "`",
    "჎": "~",
    "ზ": "(",
    "თ": ")",
    "Ⴋ": "[",
    "Ⴍ": "]",
    "ი": "*",
    "პ": "0",
    "ჟ": "1",
    "რ": "2",
    "ს": "3",
    "ტ": "4",
    "უ": "5",
    "ფ": "6",
    "ქ": "7",
    "ღ": "8",
    "ყ": "9",
}

const server = http.createServer((req, res) => {
    const url = new URL(`http://0.0.0.0:8081${req.url}`)

    if (url.pathname === "/download") {
        try {
            const page = execSync(`curl -sL ${new URL(url.searchParams.get('link'))}`)
            res.statusCode = 200;
            res.setHeader('Content-Type', 'text/html');
            res.end(replaceCharacters(mapping, page.toString()));
        } catch (e) {
            res.statusCode = 500;
            res.setHeader('Content-Type', 'text/html');
            res.end(e.toString());
        }
    } else {
        res.statusCode = 200;
        res.setHeader('Content-Type', 'text/html');
        res.end(`
            <form method="GET" action="/download">
                <input type="text" name="link" />
                <button>Download</button>
            </form>
        `);
    }

});

server.listen(8091, '0.0.0.0', () => {
    console.log(`Server running at http://0.0.0.0:8091/`);
});