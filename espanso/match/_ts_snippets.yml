# yaml-language-server: $schema=https://raw.githubusercontent.com/espanso/espanso/dev/schemas/match.schema.json

matches:
  - trigger: :egen
    label: 'Effect.gen(...)'
    force_clipboard: true
    replace: |-
      Effect.gen(function*() {
        return 1 as any;
      })

  - trigger: :efn
    label: 'Effect.fn(...)(...)'
    force_clipboard: true
    replace: |-
      Effect.fn()(function*() {
        return 1 as any;
      })

  - trigger: :efn
    label: 'Effect.fnUntraced(...)'
    force_clipboard: true
    replace: |-
      Effect.fnUntraced(function*() {
        return 1 as any;
      })

  - trigger: :imp
    label: 'import {  } from "..."'
    force_clipboard: true
    replace: import {  } from "$|$";

  - trigger: :imp
    label: '4 * import {  } from "..."'
    force_clipboard: true
    replace: |-
      import {  } from "$|$";
      import {  } from "";
      import {  } from "";
      import {  } from "";

  - trigger: :imp
    label: 'import as * XXX from "..."'
    force_clipboard: true
    replace: import * as XXX from "$|$";

  - trigger: :imp
    label: 'import XXX from "..."'
    force_clipboard: true
    replace: import XXX from "$|$";

  - trigger: ://
    label: '//'
    force_clipboard: true
    replace: |-
      /**
       * @group {{group}}
       */
    vars:
      - name: group
        type: choice
        params:
          values:
            - Schemas
            - Models
            - Errors
            - Params
            - Options
            - Services
            - Layers
            - Apis
            - Middlewares
            - Endpoints
            - Groups
            - Constructors
            - Utils
            - Constants
            - Refs
            - Components
            - Types
            - Props
            - Methods
            - Hooks
            - Requests
            - Guards
            - Functions
            - Events
            - Encoding
            - Decoding
            - Getters
            - Setters
            - Predicates

  - trigger: :idkey
    label: 'idkey'
    force_clipboard: true
    replace: |
      type id = 111;
      type key = 111;
      const key = 111;

  - trigger: :sat
    label: 'satisfies id'
    force_clipboard: true
    replace: 'satisfies id'

  - trigger: :plat
    label: '// platform::'
    force_clipboard: true
    replace: '// platform::{{platform}}'
    vars:
      - name: platform
        type: choice
        params:
          values:
            - crossplatform
            - node
            - reactnative
            - web
            - noexport

  - trigger: :tst
    force_clipboard: true
    replace: '{{output}}'
    vars:
      - name: output
        type: choice
        params:
          values:
            - label: '‚õî Error Handling'
              id: '‚õî'
            - label: '‚úÖ Happy Path'
              id: '‚úÖ'
            - label: '‚è≥ Async / Timing'
              id: '‚è≥'
            - label: 'üîó Integration'
              id: 'üîó'
            - label: 'üìú Contract / Invariant'
              id: 'üìú'
            - label: '‚ö° Performance'
              id: '‚ö°'
            - label: 'üîí Security / Access'
              id: 'üîí'
            - label: 'üêû Regression'
              id: 'üêû'
            - label: 'üîÑ Compatibility'
              id: 'üîÑ'
            - label: 'üß± Boundary / Edge cases'
              id: 'üß±'

  - trigger: :init
    label: Init Aggregate
    force_clipboard: true
    replace: |-
      // platform::crossplatform
      import { Schema, Data } from 'effect'
      import { TaggedStruct } from '@oohey/shared'

      type id = 1
      type key = 1
      const key = 1

      /**
       * @group Models
       */
      export interface $_MODULE_NAME {
        readonly _tag: key<'$_MODULE_NAME'>;
      }

      /**
       * @group Schemas
       */
      export const $_MODULE_NAME = TaggedStruct(key('$_MODULE_NAME'), {}).annotations({
        identifiers: '$_MODULE_NAME' satisfies id
      }) satisfies Schema.Schema<$_MODULE_NAME, any>

      /**
       * @group Constructors
       */
      export const make = $_MODULE_NAME.make

  - trigger: :init
    label: Init Service
    force_clipboard: true
    replace: |-
      // platform::crossplatform
      import { type Effect } from 'effect';
      import { ContextTag } from '@oohey/shared';
      import {} from './$_MODULE_NAME_MINUS_{{name}}.js';

      type id = 1;
      type key = 1;
      const key = 1;

      /**
       * @group Services
       * @hideconstructor
       */
      export abstract class $_MODULE_NAME {
        static readonly _tag = key('$_MODULE_NAME');
        static readonly Tag = ContextTag($_MODULE_NAME);
      }
    vars:
      - name: name
        type: choice
        params:
          values:
            - Service
            - Repo

  - trigger: :init
    label: Init Service Provider
    force_clipboard: true
    replace: |-
      // platform::{{platform}}
      import { Layer, Effect } from 'effect';{{impline}}
      import { $_MODULE_NAME_MINUS_Provider } from './$_MODULE_NAME_MINUS_Provider.js';

      /**
       * @group Layers
       */
      export const layer = Layer.effect(
        $_MODULE_NAME_MINUS_Provider.Tag, 
        Effect.gen(function* () {
          return 1 as any;
        }),
      );
    vars:
      - name: platform
        type: choice
        params:
          values:
            - crossplatform
            - node
            - reactnative
            - web
            - noexport
      - name: name
        type: choice
        params:
          values:
            - None
            - ServiceProvider
            - RepoProvider
      - name: impline
        type: shell
        params:
          cmd: >
            if [ "{{name}}" = "None" ]; then 
              echo ""; 
            else 
              echo "import { \$_MODULE_NAME_MINUS_{{name}} } from './\$_MODULE_NAME_MINUS_{{name}}.js';"; 
            fi

  - trigger: :init
    label: Init Interface Model
    force_clipboard: true
    replace: |-
      /**
       * @group Models
       */
      export interface {{model.name}} {
        readonly _tag: key<'{{model.name}}'>;
      }

      /**
       * @group Schemas
       */
      export const {{model.name}} = TaggedStruct(key('{{model.name}}'), {}).annotations({
        identifiers: '{{model.name}}' satisfies id
      }) satisfies Schema.Schema<{{model.name}}, any>
    vars:
      - name: model
        type: form
        params:
          layout: '–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏: [[name]]'

  - trigger: :init
    label: Init Type Model
    force_clipboard: true
    replace: |-
      /**
       * @group Models
       */
      export type {{model.name}} = {
        readonly _tag: key<'{{model.name}}'>;
      }

      /**
       * @group Schemas
       */
      export const {{model.name}} = TaggedStruct(key('{{model.name}}'), {}).annotations({
        identifiers: '{{model.name}}' satisfies id
      }) satisfies Schema.Schema<{{model.name}}, any>
    vars:
      - name: model
        type: form
        params:
          layout: '–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏: [[name]]'

  - trigger: :init
    label: Init Schema Model
    force_clipboard: true
    replace: |-
      /**
       * @group Schemas
       */
      export const {{model.name}} = Schema.Number.annotations({
        identifiers: '{{model.name}}' satisfies id
      }) satisfies Schema.Schema<{{model.name}}, any>

      /**
       * @group Models
       */
      export type {{model.name}} = Schema.Schema.Type<typeof {{model.name}}>
    vars:
      - name: model
        type: form
        params:
          layout: '–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏: [[name]]'

  - trigger: :init
    label: Init Error
    force_clipboard: true
    replace: |-
      /**
      * @group Errors
      */
      export class {{model.name}} extends Data.TaggedError(key('{{model.name}}'))<{}> {}
    vars:
      - name: model
        type: form
        params:
          layout: '–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏: [[name]]'

  - trigger: :init
    label: Init Policy
    force_clipboard: true
    replace: |-
      // platform::crossplatform
      import {} from 'effect';
      import { $_MODULE_NAME_MINUS_Policy } from './$_MODULE_NAME_MINUS_Policy.js';
      import { User } from '../User/User.js';

      /**
       * @group Contexts
       */
      export interface $_MODULE_NAME_PLUS_Context {
        readonly requester: User
        readonly _: $_MODULE_NAME_MINUS_Policy
      }

      /**
       * @group Predicates
       */
      export const canRead = (context: $_MODULE_NAME_PLUS_Context): boolean => {
        return false;
      }

      /**
       * @group Predicates
       */
      export const canUpdate = (context: $_MODULE_NAME_PLUS_Context): boolean => {
        return false;
      }

  - trigger: :test
    label: Init Integration Test File
    force_clipboard: true
    replace: |-
      import { Effect, Option, Exit } from 'effect';
      import { describe, it, assert } from '@effect/vitest';
      import { getTestEnv, provideIn } from '@oohey/vitest';
      import { causeFindTag, causeContainsTag } from '@oohey/shared';
      import { $_MODULE_NAME_MINUS_Provider } from '#modules';
      import {  } from './utils/helpers.js';
      import { layer, Setup } from './$_MODULE_NAME.setup.js';

      describe.runIf(getTestEnv().hasDb)(
        '$_MODULE_NAME',
        provideIn(layer, { sequential: true })((it) => {}),
      );

  - trigger: :test
    label: Init Unit Test File
    force_clipboard: true
    replace: |-
      import { Effect } from 'effect';
      import { describe, assert, it } from '@effect/vitest';
      import { $_MODULE_NAME } from '#modules';
      import {  } from './utils/helpers.js';

      describe.sequential('$_MODULE_NAME', () => {});

  - trigger: :test
    label: Init Setup File
    force_clipboard: true
    replace: |-
      import { Effect, Layer } from 'effect';
      import { Offset } from '@oohey/vitest';
      import { $_MODULE_NAME_MINUS_Provider } from '#modules';
      import { $_MODULE_NAME } from '#modules/node';
      import { BaseSetup } from './utils/BaseSetup.js';
      import { provideTestLayer } from './utils/provideTestLayer.js';
      import {  } from './utils/helpers.js';

      export class Setup extends Effect.Service<Setup>()('Setup', {
        effect: Effect.gen(function* () {
          yield* BaseSetup;
          return {};
        }),
      }) {}

      export const layer = $_MODULE_NAME.layer.pipe(
        Layer.merge(Setup.Default),
        provideTestLayer,
      );

  - trigger: :test
    label: Init `it` Block
    force_clipboard: true
    replace: |-
      it.effect('{{type}}', Effect.fnUntraced(function* () {}));
    vars:
      - name: type
        type: choice
        params:
          values:
            - label: '‚õî Error Handling'
              id: '‚õî'
            - label: '‚úÖ Happy Path'
              id: '‚úÖ'
            - label: '‚è≥ Async / Timing'
              id: '‚è≥'
            - label: 'üîó Integration'
              id: 'üîó'
            - label: 'üìú Contract / Invariant'
              id: 'üìú'
            - label: '‚ö° Performance'
              id: '‚ö°'
            - label: 'üîí Security / Access'
              id: 'üîí'
            - label: 'üêû Regression'
              id: 'üêû'
            - label: 'üîÑ Compatibility'
              id: 'üîÑ'
            - label: 'üß± Boundary / Edge cases'
              id: 'üß±'

  - trigger: :test
    label: Init `describe` Block
    force_clipboard: true
    replace: |-
      describe('', () => {
        it.effect('', Effect.fnUntraced(function* () {}));
      })
